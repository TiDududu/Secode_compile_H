统计结论：

​	我们首先测试了ChatGPT在主流语言中常见漏洞集上给出代码建议的情景。我们测试了CWE中的多种漏洞类型，并进行了多次重复实验以保证数据的稳定性。我们发现ChatGPT在约83%的情景中给出了正确的代码，在约40%的情景中给出了安全的代码，在正确代码的前提下，有约48%的情景给出了安全的不含漏洞的代码。我们分析ChatGPT能很好的给出逻辑上正确的，能通过编译的代码建议，但其在主流语言代码安全性上并不能让人满意，尽管根据Synopsys在2022年的OSSRA报告，81%的（2049个）代码库（人类开发者）至少包含一个漏洞，而 49% 的代码库至少包含一个高危漏洞（Synopsys, 2022），我们仍期望ChatGpt能有着更安全的代码表现。同时，值得注意的是，ChatGPT对于不同漏洞的响应不同，譬如CWE-787漏洞，其修复率仅仅只有约17%，而对于CWE-79漏洞，其修复率高达60%，在使用其作为代码生成辅助工具时应当注意这一点。

​	ChatGPT在solidity语言上的整体发挥并不那么优秀，其给出的代码建议在约60%的情况下存在漏洞，这些漏洞主要有两方面，一方面是对原始漏洞的复制而并未修复，另一方面是修复了原始漏洞但引入了新的漏洞。我们可以看出，ChatGPT在面对复杂代码环境（如真实世界中的代码项目）时的表现整体上而言仍存在不少缺陷。

​	在场景1中，我们使用的方法是给出提示让chatgpt自行生成对应的代码。我们使用了solidity的一个代码安全数据集。其中包含10种常见的漏洞场景，每个漏洞场景下有不同数目的测试用例。通过让ChatGPT进行代码补完的方式生成代码，并将生成的代码通过（）工具进行检测。检测工具的平均代码覆盖率约90%，平均分支覆盖率约85%，我们认为其检测基本包含了可能存在漏洞的代码。

​	检测结果发现，ChatGPT给出的代码建议有约25%的情况复制了原漏洞，而有高达约75%的情况修复了原漏洞，这说明其对已知漏洞的修复能力很良好。但值得注意的是，其有约33%的情况引入了与原漏洞无关的其他新漏洞，这种新漏洞的引入大大提高了漏洞率，从而降低了ChatGPT在代码安全修复工作上的可信度。

​	值得注意的是，ChatGPT给出的代码建议对于不同的漏洞情形区别很大，对于绝大部分给定的漏洞而言，其修复率都能达到50%以上，甚至对于Unprotected Selfdestruct漏洞达到了100%的修复率，但对于Assertion failure漏洞，其修复率惊人的只有约33%。其对给定的原漏洞代码的修复整体表现良好，同时也表现出了对不同漏洞修复的偏好性。

​	同时，在考察修复过程中的新漏洞引入方面，ChatGPT的代码建议也表现出了极其差异化的特征，有些漏洞从不作为新漏洞被引入，例如Unprotected  Delegatecall漏洞与Unprotected  Selfdestruct漏洞，有些漏洞几乎在任何程序中都会作为新漏洞被引入，例如Assertion failure漏洞，也有的漏洞不属于测试集中的漏洞，但被ChatGPT引入并被检测出来，例如Arbitrary memory漏洞。约有58%的漏洞是作为新漏洞出现的，意味着ChatGPT给出的代码建议中引入的新漏洞数量在一定程度上超过了其复制的原始漏洞数量。

​	在场景2中，我们使用的方法是给出部分上下文让ChatGPT补全代码。结果发现与第一组数据相比有较为明显的差异，平均漏洞率上升到了约85%，而平均原始漏洞修复率下降到了约60%，同时有约60%的情况引入了无关的新漏洞。在这种应用场景下同样的测试代码不安全性几乎显著的上升，我们推测这种使用场景对于ChatGPT-3.5而言并不是一个良好的应用，因为其生成的代码一定程度上受给出的原始测试代码的影响。我们得出结论，第一种场景即只给出关于要求的prompt更能体现出LLM给出代码建议的安全性，它能够一定程度上屏蔽原始漏洞数据对生成的影响。但第二种场景在现实中也存在实际应用，针对这种场景，应当审慎评估LLM给出代码的安全性，更好的使用方法是仅在第一种场景下使用。

​	于是我们得出一些结论：在仅给出代码要求而不是具体代码上下文时，ChatGPT能在代码安全上做的更好。ChatGPT在处理已知漏洞的修复时表现良好，尽管其表现出对不同漏洞的偏好性，其大部分情况都能处理给定的漏洞。但其在现实复杂环境中的漏洞修复能力值得怀疑和进一步评估，因为其在修复原始漏洞的同时有不小的可能会引入一个或数个无关的新漏洞，这可能是其对一个代码工程缺乏一种整体性的认知导致的。																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																				